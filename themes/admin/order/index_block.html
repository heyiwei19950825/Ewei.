{extend name="base" /}
{block name="body"}
<div class="layui-body">
    <!--tab标签-->
    <div class="layui-tab layui-tab-brief">
        <ul class="layui-tab-title">
            <li class="layui-this">订单管理</li>
        </ul>
        <div class="layui-tab-content">

            <form class="layui-form layui-form-pane" action="{:url('admin/order/index')}" method="get">
                <div class="layui-inline">
                    <label class="layui-form-label">收货人姓名</label>
                    <div class="layui-input-inline">
                        <input type="text" name="user_name" class="layui-input" value="{$order_list.param.user_name}">
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">收货人手机号</label>
                    <div class="layui-input-inline">
                        <input type="text" name="user_phone" class="layui-input" value='{$order_list.param.user_phone}'>
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">下单时间</label>
                    <div class="layui-input-inline">
                        <input type="text" name="start_time" placeholder="请选择开始时间" class="layui-input datetime" value='{$order_list.param.start_time}'>
                    </div> ——
                     <div class="layui-input-inline">
                        <input type="text" name="end_time" placeholder="请选择结束时间" class="layui-input datetime" value='{$order_list.param.end_time}'>
                    </div>
                </div>
                <div class="layui-inline">
                    <label class="layui-form-label">商品名称</label>
                    <div class="layui-input-inline">
                        <input type="text" name="keyword" placeholder="请输入关键词" class="layui-input" value="{$order_list['param']['keyword']}">
                    </div>
                </div>
                <div class="layui-inline">
                    <button class="layui-btn">搜索</button>
                </div>
            </form>
            <hr>

            <form action="" method="post" class="ajax-form">
            状态：
                <a  class="layui-btn layui-btn-small layui-btn-warm " href="{:url('admin/order/index',['user_name'=>$order_list.param.user_name,'user_phone'=>$order_list.param.user_phone,'start_time'=>$order_list.param.start_time,'end_time'=>$order_list.param.end_time,'keyword'=>$order_list['param']['keyword']])}">全部</a>
                <a  class="layui-btn layui-btn-warm layui-btn-small " href="{:url('admin/order/index',['status'=>'1','user_name'=>$order_list.param.user_name,'user_phone'=>$order_list.param.user_phone,'start_time'=>$order_list.param.start_time,'end_time'=>$order_list.param.end_time,'keyword'=>$order_list['param']['keyword']])}">未支付</a>
                <a  class="layui-btn layui-btn-warm layui-btn-small " href="{:url('admin/order/index',['status'=>'2','user_name'=>$order_list.param.user_name,'user_phone'=>$order_list.param.user_phone,'start_time'=>$order_list.param.start_time,'end_time'=>$order_list.param.end_time,'keyword'=>$order_list['param']['keyword']])}">已支付</a>
                <a  class="layui-btn layui-btn-warm layui-btn-small " href="{:url('admin/order/index',['status'=>'3','user_name'=>$order_list.param.user_name,'user_phone'=>$order_list.param.user_phone,'start_time'=>$order_list.param.start_time,'end_time'=>$order_list.param.end_time,'keyword'=>$order_list['param']['keyword']])}">已发货</a>
                <a  class="layui-btn layui-btn-warm layui-btn-small " href="{:url('admin/order/index',['status'=>'4','user_name'=>$order_list.param.user_name,'user_phone'=>$order_list.param.user_phone,'start_time'=>$order_list.param.start_time,'end_time'=>$order_list.param.end_time,'keyword'=>$order_list['param']['keyword']])}">已支付[库存不足]</a>
                <a  class="layui-btn layui-btn-warm layui-btn-small " href="{:url('admin/order/index',['status'=>'5','user_name'=>$order_list.param.user_name,'user_phone'=>$order_list.param.user_phone,'start_time'=>$order_list.param.start_time,'end_time'=>$order_list.param.end_time,'keyword'=>$order_list['param']['keyword']])}">已完成</a>
                <a  class="layui-btn layui-btn-warm layui-btn-small " href="{:url('admin/order/index',['status'=>'6','user_name'=>$order_list.param.user_name,'user_phone'=>$order_list.param.user_phone,'start_time'=>$order_list.param.start_time,'end_time'=>$order_list.param.end_time,'keyword'=>$order_list['param']['keyword']])}">已关闭</a>
                <a  class="layui-btn layui-btn-warm layui-btn-small " href="{:url('admin/order/index',['status'=>'7','user_name'=>$order_list.param.user_name,'user_phone'=>$order_list.param.user_phone,'start_time'=>$order_list.param.start_time,'end_time'=>$order_list.param.end_time,'keyword'=>$order_list['param']['keyword']])}">订单异常</a>
                <div class="layui-tab-item layui-show">
                    <table class="layui-table">
                        <thead>
                        <tr>
                            <th style="width: 15px;"><input type="checkbox" class="check-all"></th>
                            <th>商品信息</th>
                            <th>商品清单</th>
                            <th>买家</th>
                            <th>收货信息</th>
                            <th>订单金额</th>
                            <th>物流信息</th>
                            <th>交易状态</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        {foreach name="order_list['data']" item="vo"}
                        <tr style='height:20px;'>
                            <td colspan="9" style='font-size:3px;'>
                                订单号：{$vo['order_no']}&nbsp;&nbsp;&nbsp;
                                下单时间：{$vo['create_time']}
                            </td>
                        </tr>
                            
                            {foreach name="vo['snap_items']" item="s_vo" key='s_key'}
                                <tr>
                                    <td><input type="checkbox" name="ids[]" value="{$vo.id}"></td>
                                    <td width='200px;'>
                                        <img src="{$s_vo.main_img_url}" height='50px;' style='float:left;margin-right: 15px;'>
                                        {$s_vo.name}
                                    </td>
                                    <td>
                                        {$s_vo.totalPrice}元 x {$s_vo.counts}
                                    </td>
                                    
                                    {if condition="$s_key==0"}
                                        <td  rowspan="{php} echo count( $vo['snap_items'] );{/php}">
                                            {$vo['user']['nickname']}<br>
                                            手机号：{$vo['user']['mobile']}
                                        </td>
                                        <td rowspan="{php} echo count( $vo['snap_items'] );{/php}">
                                            {$vo.snap_address['name']}
                                            {$vo.snap_address['mobile']}<br><br>
                                            {$vo.snap_address['province']}
                                            {$vo.snap_address['city']}
                                            {$vo.snap_address['country']}<br>
                                            {$vo.snap_address['detail']}
                                        </td>
                                        <td rowspan="{php} echo count( $vo['snap_items'] );{/php}">
                                            {$vo['total_price']}元
                                        </td>
                                        <td rowspan="{php} echo count( $vo['snap_items'] );{/php}">
                                        </td>
                                        <td rowspan="{php} echo count( $vo['snap_items'] );{/php}">
                                            {$vo.status}
                                        </td>
                                    {/if}
                                    
                                    <td>
                                        <a href="{:url('admin/order/edit',['id'=>$vo['id']])}" class="layui-btn layui-btn-normal layui-btn-mini">编辑</a>
                                        <a  data-method="offset" href='javascript:' class="layui-btn layui-btn-warm layui-btn-mini order-detail">详情</a>
                                        <a href="{:url('admin/order/delete',['id'=>$vo['id']])}" class="layui-btn layui-btn-danger layui-btn-mini ajax-delete">删除</a>
                                    </td>
                                </tr>
                            {/foreach}
                        {/foreach}
                        </tbody>
                    </table>
                    <!--分页-->
                    {$order_list.page}
                </div>
            </form>
        </div>
    </div>
</div>
{/block}

